<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
  <meta name="description" content="momoda">
  

  
  <meta name="keywords" content="momoda">
  
  
  
  
  
  
  
  
  
  <title>Tag: 集群 | Just another blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="momoda">
<meta name="keywords" content="momoda">
<meta property="og:type" content="website">
<meta property="og:title" content="Just another blog">
<meta property="og:url" content="https://wnhby.github.io/tags/集群/index.html">
<meta property="og:site_name" content="Just another blog">
<meta property="og:description" content="momoda">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Just another blog">
<meta name="twitter:description" content="momoda">
  
    <link rel="alternative" href="/atom.xml" title="Just another blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>
</head></html>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Just another blog" rel="home">Just another blog</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">momoda blog</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/atom.xml">RSS</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/sitemap.xml">Site map</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/more/share.html">Share</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-se-notes/云计算实践/README" class="post-se-notes/云计算实践/README post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/se-notes/云计算实践/README/">云计算实践-README</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://wnhby.github.io/se-notes/云计算实践/README/" data-id="cjsbbbey3003de9s6txzm5qte" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- TOC -->
<ul>
<li><a href="#配置虚拟云主机centos-7">配置虚拟云主机(CentOS 7)</a><ul>
<li><a href="#安装操作系统">安装操作系统</a></li>
<li><a href="#配置ip地址">配置IP地址</a></li>
<li><a href="#更改yum源">更改yum源</a></li>
<li><a href="#关闭防火墙与selinux">关闭防火墙与SELinux</a></li>
<li><a href="#更改语言">更改语言</a><ul>
<li><a href="#ads">Ads</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="配置虚拟云主机-CentOS-7"><a href="#配置虚拟云主机-CentOS-7" class="headerlink" title="配置虚拟云主机(CentOS 7)"></a>配置虚拟云主机(CentOS 7)</h1><p>以下所有操作均在 root 权限下完成。</p>
<h2 id="安装操作系统"><a href="#安装操作系统" class="headerlink" title="安装操作系统"></a>安装操作系统</h2><p>以 vSphere Client 为例，当一个新的云虚拟机（非模板复制）选择完硬件配置并创建完成后，需要在该虚拟机上安装操作系统：</p>
<ol>
<li>下载操作系统的 ISO 文件（如 CentOS-7-x86_64-DVD-1511.iso ）到本地。</li>
<li>通过本地的 VMware Workstation ，设置虚拟机的光驱为“启动时连接”与“已连接”，并使用ISO镜像文件为本地已下载的操作系统ISO文件。</li>
<li>重新启动虚拟机，进入操作系统安装界面，等待一段时间后安装完成。</li>
</ol>
<p>可通过<code>passwd</code>命令来修改root密码；编辑/etc/hostname来修改主机名（重启后生效）。</p>
<h2 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h2><p>安装完操作系统后，由于 CentOS7 默认不开启网络，故需要修改一下配置才能使虚拟机自动获得由物理机所分配的IP地址。</p>
<ol>
<li>使用命令<code>cd /etc/sysconfig/network-scripts/</code> ，找到以太网卡配置文件 ifcfg-e** 文件，文件名后面的数字一般是随机生成的。把该文件里onboot的值修改为yes。此外，如果遇到网络服务重启失败，可以查看该文件里的 Mac 地址与<code>ipconfig</code>命令所查询到的 Mac 地址是否相同。</li>
<li>若<code>ifconfig</code>命令无法使用，则需使用<code>yum install net-tools.x86_64</code> 命令来安装该网络工具包。安装完成后使用该命令即可查看虚拟机所获得的IP。</li>
</ol>
<p><del>若发现无法ping通一些域名，可打开<code>vi /etc/resolv.conf</code>，增加条目 nameserver 8.8.8.8 或者 nameserver 114.114.114.114（其他可用的DNS服务器亦可）。</del> 若无法ping通域名，在 ifcfg-e** 文件中设置 DNS1 = 8.8.8.8 或 114.114.114.114。</p>
<p>若需使同一网络上的各个虚机能互相解析彼此的主机名为IP地址，需要在每个虚机的 /etc/hosts 文件里写入每一台虚机的IP地址与主机名。如<code>172.18.216.211 mon</code>。具体参考 <a href="http://os.51cto.com/art/200803/68170.htm" target="_blank" rel="noopener">/etc/hosts详解</a> 。</p>
<h2 id="更改yum源"><a href="#更改yum源" class="headerlink" title="更改yum源"></a>更改yum源</h2><p>Linux的默认官方yum源在国内访问不佳、速度慢，因此把yum源更改为国内比较好的 <a href="http://mirrors.aliyun.com/help/centos" target="_blank" rel="noopener">阿里云开源镜像站</a> 或者 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/centos/" target="_blank" rel="noopener">清华大学开源镜像站</a> 能获得极大的下载速度提升。</p>
<p>在修改完<code>/etc/yum.repos.d/</code>下yum源的CentOS-Base.repo后，依次执行<code>yum clean all</code>与<code>yum makecache</code>来删除与更新yum源的缓存。若在执行命令的过程中发现yum源总是切换到速度满的其他yum源进行下载，则可以在目录下修改该劣质yum源的repo文件，把其enabled值设置为 0 即可。</p>
<blockquote>
<p>使用<code>yum install epel-release</code>命令可安装 epel 源，该源提供了很多扩展性的功能软件。</p>
</blockquote>
<h2 id="关闭防火墙与SELinux"><a href="#关闭防火墙与SELinux" class="headerlink" title="关闭防火墙与SELinux"></a>关闭防火墙与SELinux</h2><p>使用某些网络应用时可能需要关闭防火墙与SELinux服务。</p>
<p>关闭 SELinux：编辑 /etc/selinux/config ，设置SELINUX = disabled； 执行<code># setenforce 0</code>可即时生效。可使用<code># getenforce</code>命令查看SELinux状态。</p>
<p>关闭防火墙服务：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl stop firewalld</span><br><span class="line"># systemctl disable firewalld</span><br></pre></td></tr></table></figure>
<h2 id="更改语言"><a href="#更改语言" class="headerlink" title="更改语言"></a>更改语言</h2><p>修改配置文件<code>/etc/locale.conf</code>。若改为英文则写入：<code>LANG=&quot;en_US.UTF-8&quot;</code>，改为中文则写入：<code>LANG=&quot;zh_CN.UTF-8&quot;</code>。</p>
<hr>
<ul>
<li><p><a href="/more/donate/index.html"><strong><em><font color="red">我觉得帮助到我了, 支持你一下.</font></em></strong></a><br>   </p>
</li>
<li><p><a href="https://www.paypal.me/momodainfo" target="_blank" rel="noopener"><strong><em><font color="red">If you think the article is helpful to you, you can reward me through paypal.</font></em></strong></a></p>
</li>
</ul>
<h3 id="Ads"><a href="#Ads" class="headerlink" title="Ads"></a>Ads</h3><p><em>这是小广告! 如果有需要, 不妨支持一下吧~</em></p>
<blockquote>
<p> <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;"></p>
</blockquote>
<blockquote>
<p>体育&amp;户外用品推荐</p>
</blockquote>
<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5" target="_blank" rel="noopener"><img src="/se-notes/云计算实践/README/../more/ads/amazon.gif" width="100%"></a> </div>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/se-notes/云计算实践/README/">
    <time datetime="2019-01-03T13:49:30.000Z" class="entry-date">
        1月 3 2019
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/通用技术/">通用技术</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/">云计算实践</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云计算/">云计算</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
</article>






  
    <article id="post-se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案" class="post-se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案/">HAProxy+Keepalived高可用方案</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://wnhby.github.io/se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案/" data-id="cjsbbbf1p00ame9s6a5tpw2sm" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- TOC -->
<ul>
<li><a href="#%E6%8A%80%E6%9C%AF%E7%AE%80%E4%BB%8B">技术简介</a><ul>
<li><a href="#haproxy">HAProxy</a></li>
<li><a href="#keepalived">Keepalived</a></li>
</ul>
</li>
<li><a href="#haproxy--keepalived-%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88">HAProxy + Keepalived 部署方案</a><ul>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE">前端配置</a><ul>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE-keepalived">前端配置 keepalived</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%85%8D%E7%BD%AE-haproxy">前端配置 HAProxy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">参考文档</a><ul>
<li><a href="#ads">Ads</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="技术简介"><a href="#技术简介" class="headerlink" title="技术简介"></a>技术简介</h1><h3 id="HAProxy"><a href="#HAProxy" class="headerlink" title="HAProxy"></a>HAProxy</h3><p>HAProxy（High Available Proxy）是一款提供高可用性、负载均衡以及基于 TCP（第四层）和 HTTP（第七层）应用的代理软件。 HAProxy 配置简单、支持多达上万并发连接。其运行模型可使得它非常容易和无风险地集成到现有的架构中，并且同时可以保护 web 服务器不被暴露到网络上。</p>
<h3 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h3><p>Keepalived 是一款高可用软件，它的功能是基于 VRRP 协议，通过 IP 漂移实现服务的高可用：服务器集群共享一个虚拟 IP，同一时间只有一个服务器占有虚拟 IP 并对外提供服务。若该服务器不可用，则虚拟 IP 漂移至另一台服务器并对外提供服务。</p>
<p>Keepalived 可以单独使用，即通过 IP 漂移实现服务的高可用，也可以结合 LVS 使用（即一方面通过 IP 漂移实现 LVS 负载均衡层的高可用，另一方面实现 LVS 应用服务层的状态监控）。</p>
<h1 id="HAProxy-Keepalived-部署方案"><a href="#HAProxy-Keepalived-部署方案" class="headerlink" title="HAProxy + Keepalived 部署方案"></a>HAProxy + Keepalived 部署方案</h1><p>准备四台虚机，分别记作 HA-master、HA-slave、web-node1、web-node2。前两者作为 HA 负载均衡调度器（即前端），后两者是提供应用服务的 web 服务器（即后端）。</p>
<h2 id="前端配置"><a href="#前端配置" class="headerlink" title="前端配置"></a>前端配置</h2><h3 id="前端配置-keepalived"><a href="#前端配置-keepalived" class="headerlink" title="前端配置 keepalived"></a>前端配置 keepalived</h3><p>HA-master 与 HA-slave 都需安装 keepalived 服务：<code>yum -y install keepalived</code>，keepalived 的配置文件路径为<code>/etc/keepalived/keepalived.conf</code>。</p>
<p>配置 HA-master 的 keepalived：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">   router_id HA_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;        #主从实例1</span><br><span class="line">    state MASTER            #HA-master（172.18.216.115）为主，</span><br><span class="line">                            #HA-slave（172.18.216.79）为备</span><br><span class="line">                            #在HA-slave上，该处设置为BACKUP</span><br><span class="line">    interface ens192        #与实际网卡的名称必须保持一致</span><br><span class="line">    virtual_router_id 88    #实例1的VRID为88</span><br><span class="line">    garp_master_delay 1     #在切换到master状态后，延迟进行gratuitous ARP请求</span><br><span class="line">    priority 100            #HA-master的优先级为100，HA-slave的优先级为99</span><br><span class="line">                            #在HA-slave上，该选项设置为99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 123456</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.18.216.194       #实例1的虚拟IP</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来再配置 HA-slave 的 keepalived 配置文件。HA-slave 与 HA-master 的配置文件除了<code>state</code>项与<code>priority</code>项不同以外，其他项完全相同。</p>
<p>配置完成后，在两台虚机上都用<code>service keepalived start</code>命令启动 keepalive 服务。之后在 HA-master 上使用<code>ip addr show</code>命令可以看到当前节点已经绑定了虚拟 IP。且可以通过关闭 HA-master 上的 keepalive 服务来查看虚拟 IP 是否浮动到了 HA-slave。</p>
<blockquote>
<p>但目前 haproxy 服务停止时，keepalived 服务并不会停止，所以还需要写一个脚本，使得当 haproxy 服务停止时，keepalived 服务也会停止</p>
</blockquote>
<h3 id="前端配置-HAProxy"><a href="#前端配置-HAProxy" class="headerlink" title="前端配置 HAProxy"></a>前端配置 HAProxy</h3><p>在 HA-master 与 HA-slave 上安装 HAProxy：<code>yum install haproxy</code>，然后配置 HAProxy（路径<code>/etc/haproxy/haproxy.cfg</code>）。</p>
<p>HAProxy 的配置文件分为五个部分：</p>
<ul>
<li>global：全局配置的进程级参数，用来控制 Haproxy 启动前的一些进程及系统设置</li>
<li>defaults：配置默认参数，可以被 frontend，backend，listen 段继承使用</li>
<li>frontend：定义接收请求的前端虚拟节点，可根据用户所请求的不同域名、URL 等做不同的请求处理</li>
<li>backend：定义处理业务的后端服务器集群，以及设置后端的权重、队列、连接数等选项</li>
<li>listen：frontend 和 backend 的组合体</li>
</ul>
<blockquote>
<p>对配置参数的更详细说明请查阅文末的参考文档。</p>
</blockquote>
<p>以下是 HA-master 与 HA-slave 上的配置示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    log         127.0.0.1 local2      # 定义日志输出设置</span><br><span class="line">    chroot      /var/lib/haproxy      # chroot运行路径</span><br><span class="line">    pidfile     /var/run/haproxy.pid  # haproxy进程PID文件</span><br><span class="line">    maxconn     20000                  # 默认最大连接数</span><br><span class="line">    daemon                            # 以后台形式运行harpoxy</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># common defaults that all the &apos;listen&apos; and &apos;backend&apos; sections will</span><br><span class="line"># use if not designated in their block</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">defaults</span><br><span class="line">    mode                    http         # 所处理的类别(7层代理http，4层代理tcp)</span><br><span class="line">    log                     global       # 引入global定义的日志格式</span><br><span class="line">    option                  httplog      # 日志类别为http日志格式</span><br><span class="line">    option                  dontlognull  </span><br><span class="line">    option http-server-close    # 当客户端超时时，允许服务器关闭连接</span><br><span class="line">    option forwardfor       except 127.0.0.0/8    # 在响应头部加入forwardfor</span><br><span class="line">    option                  redispatch    # 在使用了基于cookie的会话保持的时候，通常需要</span><br><span class="line">                                          # 加这么一项，一旦后端某一server宕机时，能够将</span><br><span class="line">                                          # 其会话重新派发到其它的servers</span><br><span class="line">    retries                 3             # 3次连接失败就认为服务器不可用</span><br><span class="line">    timeout http-request    10s           </span><br><span class="line">    timeout queue           1m            </span><br><span class="line">    timeout connect         10s           </span><br><span class="line">    timeout client          1m            </span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s           # 默认持久连接超时时间</span><br><span class="line">    timeout check           10s           # 心跳检查超时时间</span><br><span class="line">    maxconn                 5000          # 最大并发连接数</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># main frontend which proxys to the backends</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">frontend  proxy *:80    #前端代理</span><br><span class="line">    default_backend             dynamic</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># round robin balancing between the various backends</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend dynamic    #后端动态服务器</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    cookie      SESSION_ID insert indirect nocache    #设置cookie保持</span><br><span class="line">    server      web1  172.18.218.149:80 inter 3000 rise 2 fall 3 check maxconn 5000 cookie A</span><br><span class="line">    server      web2  172.18.216.107:80 inter 3000 rise 2 fall 3 check maxconn 5000 cookie B</span><br><span class="line">listen statistics  #设置HAProxy 的自带管理系统</span><br><span class="line">        mode http</span><br><span class="line">        bind *:8080    #把stats页面绑定到8080端口</span><br><span class="line">        stats enable   #开启stats功能</span><br><span class="line">        stats auth admin:admin    #认证的用户名和密码</span><br><span class="line">        stats uri /admin?stats    #指定uri访问路径</span><br><span class="line">        stats hide-version        #为了安全（版本bug），隐藏版本信息</span><br><span class="line">        stats refresh 5s          #页面5秒刷新一次</span><br></pre></td></tr></table></figure></p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="http://nmshuishui.blog.51cto.com/1850554/1405486" target="_blank" rel="noopener">keepalived+haproxy双主高可用负载均衡</a><br><a href="http://www.ttlsa.com/linux/haproxy-study-tutorial/" target="_blank" rel="noopener">HAProxy用法详解 全网最详细中文文档</a><br><a href="http://leejia.blog.51cto.com/4356849/1421882" target="_blank" rel="noopener">haproxy配置详解</a><br><a href="http://blief.blog.51cto.com/6170059/1750952" target="_blank" rel="noopener">HAproxy指南之haproxy配置详解</a></p>
<hr>
<ul>
<li><p><a href="/more/donate/index.html"><strong><em><font color="red">我觉得帮助到我了, 支持你一下.</font></em></strong></a><br>   </p>
</li>
<li><p><a href="https://www.paypal.me/momodainfo" target="_blank" rel="noopener"><strong><em><font color="red">If you think the article is helpful to you, you can reward me through paypal.</font></em></strong></a></p>
</li>
</ul>
<h3 id="Ads"><a href="#Ads" class="headerlink" title="Ads"></a>Ads</h3><p><em>这是小广告! 如果有需要, 不妨支持一下吧~</em></p>
<blockquote>
<p> <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;"></p>
</blockquote>
<blockquote>
<p>体育&amp;户外用品推荐</p>
</blockquote>
<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5" target="_blank" rel="noopener"><img src="/se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案/../more/ads/amazon.gif" width="100%"></a> </div>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/se-notes/云计算实践/集群高可用方案/HAProxy+Keepalived高可用方案/">
    <time datetime="2019-01-03T13:49:30.000Z" class="entry-date">
        1月 3 2019
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/通用技术/">通用技术</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/">云计算实践</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/集群高可用方案/">集群高可用方案</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云计算/">云计算</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
</article>






  
    <article id="post-se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案" class="post-se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案/">Heartbeat双机热备方案</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://wnhby.github.io/se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案/" data-id="cjsbbbf1t00ane9s6qxd3prvi" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- TOC -->
<ul>
<li><a href="#heartbeat-%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88centos">Heartbeat 部署方案（CentOS）</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE">配置</a><ul>
<li><a href="#%E8%AE%A4%E8%AF%81%E6%96%87%E4%BB%B6etchadauthkeys">认证文件（/etc/ha.d/authkeys）</a></li>
<li><a href="#%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6etchadhacf">主配置文件（/etc/ha.d/ha.cf）</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6etchadharesources">资源文件（/etc/ha.d/haresources）</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">参考文档</a></li>
<li><a href="#ads">Ads</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="Heartbeat-部署方案（CentOS）"><a href="#Heartbeat-部署方案（CentOS）" class="headerlink" title="Heartbeat 部署方案（CentOS）"></a>Heartbeat 部署方案（CentOS）</h1><blockquote>
<p>注意：Heartbeat 方案本人还未有实践过</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>两种安装方式：</p>
<ul>
<li>主从节点都使用<code>yum install heartbeat*</code>命令安装 Heartbeat（须确保已安装 epel 扩展软件包源）。</li>
<li>在 Linux-HA 官网下载 <a href="http://www.linux-ha.org/wiki/Downloads" target="_blank" rel="noopener">Heartbeat</a>。</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Heartbeat 主要的配置文件有 3 个，分别是 <strong>authkeys</strong>，<strong>ha.cf</strong> 和 <strong>haresources</strong>。其中 ha.cf 是主配置文件，haresource 用来配置要让 Heartbeat 托管的服务，authkey 是用来指定 Heartbeat 的认证方式。</p>
<blockquote>
<p>在 Heartbeat 安装后，默认并没有这三个文件，可以直接从解压的源码目录中找到。</p>
</blockquote>
<p>这里以 master/slave 两节点为例，示例的配置文件为 master 节点的。</p>
<h3 id="认证文件（-etc-ha-d-authkeys）"><a href="#认证文件（-etc-ha-d-authkeys）" class="headerlink" title="认证文件（/etc/ha.d/authkeys）"></a>认证文件（/etc/ha.d/authkeys）</h3><p>该文件为 Heartbeat 的认证文件，该文件主要是用于集群中两个节点的认证，采用的算法和密钥（如果有的话）在集群中节点上必须相同。目前提供了 3 种算法：crc/md5/sha1。其中 crc 不能够提供认证，它只能够用于校验数据包是否损坏，而 sha1/md5 需要一个密钥来进行认证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auth 2</span><br><span class="line">#1 crc</span><br><span class="line">2 sha1 somewords</span><br><span class="line">#3 md5 somewords</span><br></pre></td></tr></table></figure>
<p>以上示例中使用的是 sha1 算法，如果要换用其他算法只需要修改 auth 指令后面的数字，然后取消相应行的注释即可。</p>
<blockquote>
<p>注意：该文件的属性必须为600，否则 Heartbeat 启动将失败。且两个节点的 authkeys 文件内容及权限相同。</p>
</blockquote>
<h3 id="主配置文件（-etc-ha-d-ha-cf）"><a href="#主配置文件（-etc-ha-d-ha-cf）" class="headerlink" title="主配置文件（/etc/ha.d/ha.cf）"></a>主配置文件（/etc/ha.d/ha.cf）</h3><p>该文件是 Heartbeat 的主配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">keepalive 2</span><br><span class="line">warntime 5</span><br><span class="line">deadtime 30</span><br><span class="line">initdead 120</span><br><span class="line">udpport 6942</span><br><span class="line">bcast eth0</span><br><span class="line"># mcast eth0 225.0.0.1 694 1 0</span><br><span class="line">ucast eth1 &#123;&#123; slave的IP地址 &#125;&#125;</span><br><span class="line">auto_failback off</span><br><span class="line">watchdog /dev/watchdog</span><br><span class="line">node host41 host42</span><br><span class="line"># ping 172.16.12.1 ping_group group1 172.16.12.1</span><br><span class="line">respawn hacluster /usr/lib64/heartbeat/ipfail</span><br><span class="line">respawn hacluster /usr/lib64/heartbeat/dopd</span><br><span class="line">apiauth dopd gid=haclient uid=hacluster</span><br><span class="line">use_logd yes</span><br></pre></td></tr></table></figure>
<ul>
<li>keepalive：发送心跳报文的间隔。默认单位为秒，也可以使用 500ms 来指代 500 毫秒，等同于 0.5。</li>
<li>warntime：认为对方可能宕掉的间隔时间。</li>
<li>deadtime：认为对方宕掉的间隔时间，超过这个时间，则认为对方已经宕掉。</li>
<li>initdead：等待对方启动的最大时间。</li>
<li>udpport：heartbeat 广播/单播通讯使用的 udp 端口。</li>
<li>bcast：心跳所使用的网络接口。</li>
<li>ucast：单播通讯，对方网络接口及IP地址。</li>
<li>mcast：组播通讯，参数如右：通讯所用的接口 绑定的组播IP（224.0.0.0-239.255.255.255）通讯端口 ttl 是否允许环回。</li>
<li>auto_failback：表示当主节点（即提供资源/服务的节点）正常之后是否将资源/服务切换回来。</li>
<li>watchdog：看门狗定时器，如果节点一分钟内没有心跳，则重启节点。</li>
<li>node：heartbeat 集群中的节点信息（节点的主机名: uname -n）。</li>
<li>ping/ping_group：用于建立伪集群成员，作用是监测物理链路，如果该节点与伪集群成员不相通，那么该节点无权接管资源/服务。</li>
</ul>
<p>另一从节点（slave）需要将 ha.cf 文件中 ucast 的 IP 地址改为主节点（master）的 IP 地址。</p>
<h3 id="资源文件（-etc-ha-d-haresources）"><a href="#资源文件（-etc-ha-d-haresources）" class="headerlink" title="资源文件（/etc/ha.d/haresources）"></a>资源文件（/etc/ha.d/haresources）</h3><p>haresources 文件用于指定双机系统的主节点、集群IP、子网掩码、广播地址以及启动的服务等集群资源。文件每一行可以包含一个或多个资源脚本名，资源之间使用空格隔开，参数之间使用两个冒号隔开。在两个节点上该文件必须完全一致，此文件的一般格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node-name network &lt;resource-group&gt;</span><br></pre></td></tr></table></figure></p>
<p>node-name 表示主节点的主机名，必须和 ha.cf 文件中指定的节点名一致；network 用于设定集群的 IP 地址、子网掩码、网络设备标识等（这里指定的IP地址就是集群对外服务的IP地址），resource-group 用来指定需要 Heartbeat 托管的服务，也就是这些服务可以由 Heartbeat 来启动和关闭，如果要托管这些服务，必须将服务写成可以通过 start/stop 来启动和关闭的脚本，然后放到 /etc/init.d/ 或者 /etc/ha.d/resource.d/ 目录下，heartbeat 会根据脚本的名称自动去 /etc/init.d 或者 /etc/ha.d/resource.d/ 目录下找到相应脚本进行启动或关闭操作。</p>
<p>以下是一个具体实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node1 IPaddr::192.168.60.200/24/eth0/  Filesystem::/dev/sdb5::/webdata::ext3  httpd tomcat</span><br></pre></td></tr></table></figure></p>
<p>其中，node1 是 HA 集群的主节点，IPaddr 为 HeartbeatH自带的一个执行脚本，Heartbeat 首先将执行<code>/etc/ha.d/resource.d/IPaddr 192.168.60.200/24 start</code>的操作，也就是虚拟出一个子网掩码为 255.255.255.0，IP为 192.168.60.200 的地址，此IP为 Heartbeat 对外提供服务的网络地址，同时指定此 IP 使用的网络接口为 eth0，接着，Heartbeat 将执行共享磁盘分区的挂载操作，<code>Filesystem::/dev/sdb5::/webdata::ext3</code>相当于在命令行下执行 mount 操作，即“mount –t ext3 /dev/sdb5 /webdata”，最后依次启动 httpd 和 tomcat 服务。</p>
<blockquote>
<p>注意：主节点和从节点中资源文件 haresources 一般要完全一致。</p>
</blockquote>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="http://ixdba.blog.51cto.com/2895551/548625" target="_blank" rel="noopener">Linux-HA开源软件Heartbeat（配置篇）</a><br><a href="https://github.com/chenzhiwei/linux/tree/master/heartbeat" target="_blank" rel="noopener">heartbeat配置相关</a></p>
<hr>
<ul>
<li><p><a href="/more/donate/index.html"><strong><em><font color="red">我觉得帮助到我了, 支持你一下.</font></em></strong></a><br>   </p>
</li>
<li><p><a href="https://www.paypal.me/momodainfo" target="_blank" rel="noopener"><strong><em><font color="red">If you think the article is helpful to you, you can reward me through paypal.</font></em></strong></a></p>
</li>
</ul>
<h3 id="Ads"><a href="#Ads" class="headerlink" title="Ads"></a>Ads</h3><p><em>这是小广告! 如果有需要, 不妨支持一下吧~</em></p>
<blockquote>
<p> <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;"></p>
</blockquote>
<blockquote>
<p>体育&amp;户外用品推荐</p>
</blockquote>
<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5" target="_blank" rel="noopener"><img src="/se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案/../more/ads/amazon.gif" width="100%"></a> </div>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案/">
    <time datetime="2019-01-03T13:49:30.000Z" class="entry-date">
        1月 3 2019
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/通用技术/">通用技术</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/">云计算实践</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/集群高可用方案/">集群高可用方案</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云计算/">云计算</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
</article>






  
    <article id="post-se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案" class="post-se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案/">LVS+Keepalived双机热备方案</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://wnhby.github.io/se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案/" data-id="cjsbbbf1y00ase9s690ywus8e" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- TOC -->
<ul>
<li><a href="#lvs--keepalived-%E5%8F%8C%E6%9C%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88centos">LVS + keepalived 双机高可用部署方案（CentOS）</a><ul>
<li><a href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87">前期准备</a></li>
<li><a href="#web-%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE">web 节点配置</a></li>
<li><a href="#lvs-%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE">LVS 节点配置</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95">测试</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3">参考文档</a></li>
<li><a href="#ads">Ads</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="LVS-keepalived-双机高可用部署方案（CentOS）"><a href="#LVS-keepalived-双机高可用部署方案（CentOS）" class="headerlink" title="LVS + keepalived 双机高可用部署方案（CentOS）"></a>LVS + keepalived 双机高可用部署方案（CentOS）</h1><h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><p>准备四台虚机，分别记作 LVS-master、LVS-slave、web-node1、web-node2。前两者作为 LVS 负载均衡调度器，后两者是提供应用服务的 web 服务器。</p>
<p>安装<code>epel-realease</code>源，关闭所有虚机的防火墙与 SELinux，编辑所有节点的<code>/etc/hosts</code>文件设置主机名互相解析。使用<code>yum install ntpdate</code>安装 ntpdate，并通过<code>ntpdate 202.120.2.101</code>命令进行时间同步。</p>
<blockquote>
<p>202.120.2.101 是上海交通大学网络中心 NTP 服务器的地址</p>
</blockquote>
<h3 id="web-节点配置"><a href="#web-节点配置" class="headerlink" title="web 节点配置"></a>web 节点配置</h3><p>在两台 web 机上开启 httpd 服务，并编辑 Real Server （真实服务器，简称 RS）用于绑定 VIP （虚拟 IP）脚本<code>realserver.sh</code>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash  </span><br><span class="line">#   </span><br><span class="line"># Script to start LVS DR real server.   </span><br><span class="line"># description: LVS DR real server   </span><br><span class="line">#   </span><br><span class="line">.  /etc/rc.d/init.d/functions</span><br><span class="line">VIP=192.168.18.200   # 在此处设置VIP  </span><br><span class="line">host=`/bin/hostname`</span><br><span class="line">case &quot;$1&quot; in  </span><br><span class="line">start)   </span><br><span class="line">       # Start LVS-DR real server on this machine.   </span><br><span class="line">        /sbin/ifconfig lo down   </span><br><span class="line">        /sbin/ifconfig lo up   </span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore   </span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce   </span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore   </span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        /sbin/ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up  </span><br><span class="line">        /sbin/route add -host $VIP dev lo:0</span><br><span class="line">;;  </span><br><span class="line">stop)</span><br><span class="line">        # Stop LVS-DR real server loopback device(s).  </span><br><span class="line">        /sbin/ifconfig lo:0 down   </span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore   </span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce   </span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore   </span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">;;  </span><br><span class="line">status)</span><br><span class="line">        # Status of LVS-DR real server.  </span><br><span class="line">        islothere=`/sbin/ifconfig lo:0 | grep $VIP`   </span><br><span class="line">        isrothere=`netstat -rn | grep &quot;lo:0&quot; | grep $VIP`   </span><br><span class="line">        if [ ! &quot;$islothere&quot; -o ! &quot;isrothere&quot; ];then   </span><br><span class="line">            # Either the route or the lo:0 device   </span><br><span class="line">            # not found.   </span><br><span class="line">            echo &quot;LVS-DR real server Stopped.&quot;   </span><br><span class="line">        else   </span><br><span class="line">            echo &quot;LVS-DR real server Running.&quot;   </span><br><span class="line">        fi   </span><br><span class="line">;;   </span><br><span class="line">*)   </span><br><span class="line">            # Invalid entry.   </span><br><span class="line">            echo &quot;$0: Usage: $0 &#123;start|status|stop&#125;&quot;   </span><br><span class="line">            exit 1   </span><br><span class="line">;;   </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<p>使用 <code>chmod +x realserver.sh</code>命令给脚本文件添加执行权限，并通过<code>/.realserver.sh start</code>命令启动该脚本的服务。该服务的作用是使 RS 的网卡与 VIP 进行绑定，从而可允许 RS 处理来自负载调度器转发的请求（DR 模式）。启动该服务后可用<code>ifconfig</code>命令查看是否已绑定 VIP。</p>
<h3 id="LVS-节点配置"><a href="#LVS-节点配置" class="headerlink" title="LVS 节点配置"></a>LVS 节点配置</h3><p>LVS 节点使用<code>yum install keepalived ipvsadm</code>命令安装 keepalived 服务与 LVS 服务。</p>
<p>配置文件的路径是<code>/etc/keepalived/keepalived.conf</code>。keepalived 配置文件以 block 形式组织，每个块内容都包含在<code>{}</code>中。keepalived 配置分为三类：</p>
<ul>
<li>全局配置：对整个 keepalived 都生效的配置</li>
<li>VRRPD 配置：核心配置，主要实现高可用功能</li>
<li>LVS 配置：LVS 相关功能的配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">######################</span><br><span class="line">#  全局配置（大部分选项为邮件通知服务的参数。可设置为空）</span><br><span class="line">######################</span><br><span class="line">global_defs &#123;                               # global_defs 全局配置标识 </span><br><span class="line">                                            --------------------------------------</span><br><span class="line">   notification_email &#123;                     # notification_email用于设置报警邮件地址</span><br><span class="line">     acassen@firewall.loc                   # 可以设置多个，每行一个</span><br><span class="line">     failover@firewall.loc                  # 设置邮件报警，需开启本机Sendmail 服务</span><br><span class="line">     sysadmin@firewall.loc                  # yum -y install mailx sendmail</span><br><span class="line">   &#125;                                        --------------------------------------</span><br><span class="line">   </span><br><span class="line">   notification_email_from 233@qq.com  # 设置邮件发送地址</span><br><span class="line">   smtp_server 192.168.200.1           # 设置邮件的smtp server地址</span><br><span class="line">   smtp_connect_timeout 30             # 设置连接smtp sever超时时间</span><br><span class="line">   router_id LVS_DEVEL                 # 表示运行keepalived服务器标识</span><br><span class="line">									   # 发邮件时会显示在邮件主题中</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">######################</span><br><span class="line">#  VRRPD配置</span><br><span class="line">######################</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;         # VRRPD 配置标识 VI_1是实例名称</span><br><span class="line"></span><br><span class="line">    state MASTER             # 指定Keepalvied角色。</span><br><span class="line">                             # MASTER表示此主机为主服务器，BACKUP则是表示为备用服务器</span><br><span class="line">    interface eth0           # 指定HA监测网络的接口。检查是否与ifconfig命令查看的网卡名称一致。</span><br><span class="line">    virtual_router_id 51     # 虚拟路由标识，标识为数字，同一个VRRP实例使用唯一的标识</span><br><span class="line">                             # 即可表示在同一个vrrp_instance下 MASTER_ID = BACKUP_ID</span><br><span class="line">    priority 100             # 定义节点优先级，数字越大表示节点的优先级越高</span><br><span class="line">                             # 同一个VRRP_instance下</span><br><span class="line">                             # 必须 MASTE_PRIORITY &gt; BACKUP_PRIORITY </span><br><span class="line">    advert_int 1             # 设定MASTER与BACKUP主机质检同步检查的时间间隔，单位为秒</span><br><span class="line">             </span><br><span class="line">    authentication &#123;         # 设定节点间通信验证类型和密码，验证类型主要有PASS和AH两种</span><br><span class="line">        auth_type PASS       # 同一个vrrp_instance，MASTER验证密码和BACKUP保持一致</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    virtual_ipaddress &#123;      # 设置虚拟IP地址 (VIP)，也可仅设置一个</span><br><span class="line">        192.168.200.16</span><br><span class="line">        192.168.200.17</span><br><span class="line">        192.168.200.18</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">######################</span><br><span class="line"># LVS配置</span><br><span class="line">######################</span><br><span class="line"></span><br><span class="line">virtual_server 192.168.18.200 80 &#123;    # virtual_server LVS配置标识 </span><br><span class="line">                                      # 格式：virtual_server [VIP] [port]</span><br><span class="line">    delay_loop 6     # 设置健康检查时间间隔，单位为秒   </span><br><span class="line">    lb_algo rr       # 设置负载调度算法，可用的调度算法有：rr、wlc、lc、lblc、sh、dh等</span><br><span class="line">    lb_kind DR       # 设置LVS实现负载均衡的机制，有NAT、TUN和DR三种模式可选                   </span><br><span class="line">    nat_mask 255.255.255.0   # NAT子网掩码</span><br><span class="line">    persistence_timeout 50  # 会话保持时间 </span><br><span class="line">    protocol TCP             # 指定转发协议类型</span><br><span class="line">    </span><br><span class="line">#---------------------------------------------------------------------------------</span><br><span class="line"># persistence_timeout 会话保持时间对动态网页非常有用，为集群系统中的seesion共享提供了一个很好的解决方案</span><br><span class="line"># 用户的请求会一直分发到某个服务节点，直至超过这个会话的保持时间（指最大无响应超时时间）</span><br><span class="line"># =[用户操作动态页面如果在50s没有执行任何操作则被分发到另外的节点]</span><br><span class="line">#---------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">    real_server 192.168.18.201 80 &#123; # 设置real server段开始的标识 [IP为真实IP地址]</span><br><span class="line">        weight 1                    # 用于配置real server节点的权值，数字越大，权值越高</span><br><span class="line">                                    # 设置权值大小可以为不同性能的服务器分配不同的负载</span><br><span class="line">        HTTP_GET &#123;   </span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">          status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    real_server 192.168.18.202 80 &#123;   </span><br><span class="line">        weight 1   </span><br><span class="line">        HTTP_GET &#123;   </span><br><span class="line">            url &#123;   </span><br><span class="line">              path /   </span><br><span class="line">              status_code 200   </span><br><span class="line">            &#125;   </span><br><span class="line">            connect_timeout 2   </span><br><span class="line">            nb_get_retry 3   </span><br><span class="line">            delay_before_retry 1   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>keepalived 的配置文件路径在<code>/etc/keepalived/keepalived.conf</code>。LVS-master 与 LVS-slave 的配置文件除了 VRRPD 配置中的状态与优先级这两个参数不同外，其他参数应当相同。</p>
<p>配置完成后，启动 LVS-master 与 LVS-slave的 keepalived 服务：<code>service keepalived start</code>，并可使用<code>ipvsadm -L -n</code>命令查看 LVS 状态。</p>
<blockquote>
<p>Tips：可使用<code>service keepalived status</code>命令查看 keepalived 服务的 log。</p>
</blockquote>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>通过关闭与开启 LVS-master 的 keepalived 服务，观察 VIP 在 LVS 节点上的浮动情况。通过关闭与开启某一个 web 节点的 web 服务，观察集群的高可用是否生效。</p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p>实验步骤参考：<a href="http://freeloda.blog.51cto.com/2033581/1280962" target="_blank" rel="noopener">Linux 高可用集群之keepalived详解</a><br>详细配置参数参考：<a href="https://my.oschina.net/luciamoore/blog/607034" target="_blank" rel="noopener">Keepalived 工作原理及简要安装</a></p>
<hr>
<ul>
<li><p><a href="/more/donate/index.html"><strong><em><font color="red">我觉得帮助到我了, 支持你一下.</font></em></strong></a><br>   </p>
</li>
<li><p><a href="https://www.paypal.me/momodainfo" target="_blank" rel="noopener"><strong><em><font color="red">If you think the article is helpful to you, you can reward me through paypal.</font></em></strong></a></p>
</li>
</ul>
<h3 id="Ads"><a href="#Ads" class="headerlink" title="Ads"></a>Ads</h3><p><em>这是小广告! 如果有需要, 不妨支持一下吧~</em></p>
<blockquote>
<p> <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;"></p>
</blockquote>
<blockquote>
<p>体育&amp;户外用品推荐</p>
</blockquote>
<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5" target="_blank" rel="noopener"><img src="/se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案/../more/ads/amazon.gif" width="100%"></a> </div>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/se-notes/云计算实践/集群高可用方案/LVS+Keepalived双机热备方案/">
    <time datetime="2019-01-03T13:49:30.000Z" class="entry-date">
        1月 3 2019
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/通用技术/">通用技术</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/">云计算实践</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/集群高可用方案/">集群高可用方案</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云计算/">云计算</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
</article>






  
    <article id="post-se-notes/云计算实践/集群高可用方案/README" class="post-se-notes/云计算实践/集群高可用方案/README post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/se-notes/云计算实践/集群高可用方案/README/">集群高可用方案-README</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://wnhby.github.io/se-notes/云计算实践/集群高可用方案/README/" data-id="cjsbbbf2100ave9s69lzss55a" class="leave-reply bdsharebuttonbox" data-cmd="more">分享</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <!-- TOC -->
<ul>
<li><a href="#%E9%9B%86%E7%BE%A4%E9%AB%98%E5%8F%AF%E7%94%A8%E6%96%B9%E6%A1%88%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D">集群高可用方案概念介绍</a><ul>
<li><a href="#%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87">双机热备</a></li>
<li><a href="#lvs">LVS</a></li>
<li><a href="#keepalived">Keepalived</a></li>
<li><a href="#heartbeat">Heartbeat</a></li>
<li><a href="#keepalived-vs-heartbeat">Keepalived VS Heartbeat</a></li>
<li><a href="#drbd">DRBD</a></li>
<li><a href="#ads">Ads</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="集群高可用方案概念介绍"><a href="#集群高可用方案概念介绍" class="headerlink" title="集群高可用方案概念介绍"></a>集群高可用方案概念介绍</h1><h3 id="双机热备"><a href="#双机热备" class="headerlink" title="双机热备"></a>双机热备</h3><p>双机热备特指高可用服务器集群中两台服务器的高可用，目标是实现如下场景：</p>
<ul>
<li>两台 Web 服务器为主从备份，并同时开启，但只有主服务器对外提供服务。（或者通过负载均衡同时对外提供服务）</li>
<li>当主服务器宕机时，从服务器接管服务，且 IP 地址保持不变。</li>
<li>主服务器与从服务器的数据库与静态文件资源保持实时一致。</li>
</ul>
<h3 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h3><p>LVS（Linux Virtual Server）即 Linux 虚拟服务器，采用 IP 负载均衡技术和基于内容请求分发技术，是一个高可伸缩、高可用网络服务的虚拟服务器集群系统，主要用于服务器集群的<strong>负载均衡</strong>。</p>
<p>使用 LVS 架设的服务器集群系统有三个部分组成：</p>
<ul>
<li><strong>负载调度器</strong>（Load Balancer）：整个集群对外服务的前端机，负责将用户请求发送到一组服务器上执行，而用户认为服务只来自一个IP地址（即 Virtual IP）。</li>
<li><strong>服务器集群</strong>（Server Array），是一组真正执行客户请求的服务器（Real Server），执行的服务包括但不限于 WEB、MAIL、FTP 和 DNS 等。</li>
<li><strong>共享存储</strong>（Shared Storage）：为服务器池所提供的一个共享存储区，这样可使得服务器集群拥有相同的内容，提供相同的服务。</li>
</ul>
<blockquote>
<p>LVS 集群中的负载调度器具有很好的吞吐率，可将请求均衡地转移到不同的服务器上执行，且负载调度器自动屏蔽掉服务器的故障，从而将一组服务器构成一个高性能的、高可用的虚拟服务器。整个服务器集群的结构对客户是黑箱状态，而且无需修改客户端和服务器端的程序。</p>
</blockquote>
<p><img src="http://img1.51cto.com/attachment/201104/110349553.png" alt="enter image description here"></p>
<p>LVS 的实现方式主要分为 NAT（网络地址转换）与 DR（直接路由）两种。</p>
<ul>
<li>NAT：目标 IP 为 VIP（Virtual IP）的用户请求经过 DS （Director Server）时进行了 IP 地址转换，把 VIP 换成了 RS（Real Server） 的实际 IP。RS 处理完请求后需要把 response 再发回给 DS，再由 DS 转换为 VIP 后返回给请求的用户。（优点是服务器可以运行任何支持 TCP/IP 的操作系统；缺点是 response 都要经过 DS，伸缩能力有限，难以支持大集群）</li>
<li>DR：目标 IP 为 VIP 的用户请求经过 DS 时进行了 MAC 地址转换，把 MAC 地址修改为了 RS 的实际 MAC 地址。RS 处理完请求后把 response 直接返回给用户。（优点是伸缩性强，但需要 DS 与 RS 在同一个物理子网）</li>
</ul>
<blockquote>
<p>注意：LVS 集群中的负载调度器不可与真实服务器是同一台机器。因为 LVS 是<strong>四层负载均衡</strong>（基于传输层，请求的转发通过修改 IP 地址或目标 MAC 地址来实现），所以无法保证一个请求是交付给本机的负载均衡器进行调度还是交付给本机的应用程序处理，因此可能会陷入自己不断把请求发给自己的死循环。</p>
</blockquote>
<p><a href="http://www.linuxvirtualserver.org/zh/lvs1.html" target="_blank" rel="noopener">LVS 官方中文文档</a><br><a href="http://bbs.linuxtone.org/thread-20357-1-1.html" target="_blank" rel="noopener">LVS + Keepalived 中 Vip 不能访问</a></p>
<h3 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h3><p>Keepalived 是一款高可用软件，它的功能主要包括两方面：</p>
<ul>
<li>基于 VRRP 协议，通过 IP 漂移实现服务的高可用：服务器集群共享一个虚拟 IP，同一时间只有一个服务器占有虚拟 IP 并对外提供服务。若该服务器不可用，则虚拟 IP 漂移至另一台服务器并对外提供服务；</li>
<li>对 LVS 应用服务层的应用服务器集群进行状态监控：若应用服务器不可用，则 Keepalived 将其从集群中摘除，若应用服务器恢复，则 Keepalived 将其重新加入集群中。</li>
</ul>
<blockquote>
<p>Keepalived 可以单独使用，即通过 IP 漂移实现服务的高可用，也可以结合 LVS 使用（即一方面通过IP漂移实现 LVS 负载均衡层的高可用，另一方面实现 LVS 应用服务层的状态监控）。</p>
</blockquote>
<h3 id="Heartbeat"><a href="#Heartbeat" class="headerlink" title="Heartbeat"></a>Heartbeat</h3><p>Heartbeat 是 Linux-HA 工程的一个组件，是集群管理中保证集群高可用的服务软件，它可以瞬间接管一台机器上的所有资源（包括访问资源、提供服务的资源和IP地址等等）。</p>
<p>Heartbeat 最核心的两个部分是<strong>心跳监测</strong>和<strong>资源接管</strong>。<strong>心跳监测</strong>使设备之间相互发送报文来告诉对方自己当前的状态，如果在指定的时间内未收到对方发送的报文，那么就认为对方失效，这时需启动<strong>资源接管</strong>模块来接管运行在对方主机上的资源或者服务。</p>
<h3 id="Keepalived-VS-Heartbeat"><a href="#Keepalived-VS-Heartbeat" class="headerlink" title="Keepalived VS Heartbeat"></a>Keepalived VS Heartbeat</h3><ul>
<li>Keepalived 使用更简单：从安装、配置、使用、维护等角度上对比，Keepalived 都比 Heartbeat 要简单得多，尤其是 Heartbeat 2.1.4 后拆分成3个子项目，安装、配置、使用都比较复杂；而 Keepalived 只有1个安装文件和1个配置文件。</li>
<li>Heartbeat 功能更强大：Heartbeat 虽然复杂，但功能更强大，配套工具更全，适合做大型集群管理；而 Keepalived 主要用于集群倒换，基本没有管理功能。</li>
<li>协议不同：Keepalived 使用 VRRP 协议进行通信和选举，Heartbeat 使用心跳进行通信和选举；Heartbeat 除了网络外还可以通过串口通信，更加可靠。</li>
<li>使用方式类似：如果要基于两者设计高可用方案，最终都要根据业务需要写自定义的脚本。Keepalived 的脚本没有约束；Heartbeat 的脚本有约束，即需要支持 service start/stop/restart 这种方式。</li>
<li>接管方式不同：Keepalived 仅能用于接管IP地址，而 Heartbeat 可以接管IP、服务、存储等多种资源。且 Keepalived 集群中所有节点保证服务都开启，而 Heartbeat 集群只需要保证主节点服务开启即可（主节点宕机再由从节点开启服务）。</li>
</ul>
<blockquote>
<p>建议：优先使用 Keepalived，当 Keepalived 功能不够用的时候才选择 Heartbeat</p>
</blockquote>
<p><a href="https://serverfault.com/questions/361071/what-is-the-difference-between-keepalive-and-heartbeat" target="_blank" rel="noopener">What is the difference between keepalive and heartbeat?</a></p>
<h3 id="DRBD"><a href="#DRBD" class="headerlink" title="DRBD"></a>DRBD</h3><p>DRBD （Distributed Replicated Block Device）是一种基于软件的，无共享，复制的存储解决方案，在服务器之间对块设备（硬盘，分区，逻辑卷等）进行镜像。DRBD 负责接收数据，把数据写到本地磁盘，然后通过网络将同样的数据发送给另一个主机，另一个主机再将数据存到自己的磁盘中。</p>
<p>工作原理：每个设备都有一个状态，可能是<strong>主状态</strong>或<strong>从状态</strong>。在主节点上，应用程序应能运行和访问 DRBD 设备（/dev/drbd*），且每次写入都会发往本地磁盘设备和从节点设备中。从节点只能简单地把数据写入它的磁盘设备上。 读取数据通常在本地进行。 如果主节点发生故障，心跳（heartbeat 或 corosync）将会把从节点转换到主状态，并启动其上的应用程序。如果发生故障的节点恢复工作，它就会成为新的从节点，而且必须使自己的内容与主节点的内容保持同步。</p>
<hr>
<ul>
<li><p><a href="/more/donate/index.html"><strong><em><font color="red">我觉得帮助到我了, 支持你一下.</font></em></strong></a><br>   </p>
</li>
<li><p><a href="https://www.paypal.me/momodainfo" target="_blank" rel="noopener"><strong><em><font color="red">If you think the article is helpful to you, you can reward me through paypal.</font></em></strong></a></p>
</li>
</ul>
<h3 id="Ads"><a href="#Ads" class="headerlink" title="Ads"></a>Ads</h3><p><em>这是小广告! 如果有需要, 不妨支持一下吧~</em></p>
<blockquote>
<p> <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;"></p>
</blockquote>
<blockquote>
<p>体育&amp;户外用品推荐</p>
</blockquote>
<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5" target="_blank" rel="noopener"><img src="/se-notes/云计算实践/集群高可用方案/README/../more/ads/amazon.gif" width="100%"></a> </div>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/se-notes/云计算实践/集群高可用方案/README/">
    <time datetime="2019-01-03T13:49:30.000Z" class="entry-date">
        1月 3 2019
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/通用技术/">通用技术</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/">云计算实践</a>, <a class="article-category-link" href="/categories/通用技术/云计算实践/集群高可用方案/">集群高可用方案</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云计算/">云计算</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/集群/">集群</a></li></ul>

    </footer>
</article>






  
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="q">
        <input type="submit" id="searchsubmit" value="google搜索">
    </div>
</form></aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/系统剩余空间查看/">系统剩余空间查看</a>
          </li>
        
          <li>
            <a href="/数据库分类/">数据库分类</a>
          </li>
        
          <li>
            <a href="/se-notes/Linux基础/README/">Linux基础-README</a>
          </li>
        
          <li>
            <a href="/se-notes/云计算实践/区块链相关/区块链简介/">区块链简介</a>
          </li>
        
          <li>
            <a href="/se-notes/云计算实践/集群高可用方案/Heartbeat双机热备方案/">Heartbeat双机热备方案</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Archives</h3>
    <div class="widget-content">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">56</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">一月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-content">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Graphics/">Graphics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/linux基础/">linux基础</a><span class="category-list-count">6</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/协议证书/">协议证书</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/协议证书/openssl/">openssl</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/数据库基础/">数据库基础</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/框架/">框架</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/框架/python-web应用框架/">python-web应用框架</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制/">版本控制</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/版本控制/Git/">Git</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/">编程语言</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/java/">java</a><span class="category-list-count">13</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络通讯/">网络通讯</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/网络通讯/大小端/">大小端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络通讯/计算机网络基础/">计算机网络基础</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/路由器/">路由器</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/路由器/openwrt/">openwrt</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/">通用技术</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/云计算实践/">云计算实践</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/云计算实践/kubernetes部署/">kubernetes部署</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/云计算实践/区块链/">区块链</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/通用技术/云计算实践/集群高可用方案/">集群高可用方案</a><span class="category-list-count">4</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/默认/">默认</a><span class="category-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CS-Notes/">CS-Notes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PEM证书/">PEM证书</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cron/">cron</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diagrams/">diagrams</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-qq/">docker-qq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graphics/">graphics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/informationisbeautiful/">informationisbeautiful</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java基础/">java基础</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java语法/">java语法</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/">kubernetes</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/">openssl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openwrt/">openwrt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/p12/">p12</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pfx/">pfx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp-ip/">tcp/ip</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web开发/">web开发</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/云计算/">云计算</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/区块链/">区块链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大小端/">大小端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/系统管理/">系统管理</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机网络/">计算机网络</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/集群/">集群</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/默认/">默认</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/CS-Notes/" style="font-size: 10px;">CS-Notes</a> <a href="/tags/PEM证书/" style="font-size: 10px;">PEM证书</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/cron/" style="font-size: 10px;">cron</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/diagrams/" style="font-size: 10px;">diagrams</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/docker-qq/" style="font-size: 10px;">docker-qq</a> <a href="/tags/flask/" style="font-size: 16.25px;">flask</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/graphics/" style="font-size: 10px;">graphics</a> <a href="/tags/http/" style="font-size: 17.5px;">http</a> <a href="/tags/informationisbeautiful/" style="font-size: 10px;">informationisbeautiful</a> <a href="/tags/java基础/" style="font-size: 20px;">java基础</a> <a href="/tags/java语法/" style="font-size: 20px;">java语法</a> <a href="/tags/kubernetes/" style="font-size: 13.75px;">kubernetes</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mysql/" style="font-size: 11.25px;">mysql</a> <a href="/tags/network/" style="font-size: 17.5px;">network</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/openwrt/" style="font-size: 10px;">openwrt</a> <a href="/tags/p12/" style="font-size: 10px;">p12</a> <a href="/tags/pfx/" style="font-size: 10px;">pfx</a> <a href="/tags/tcp-ip/" style="font-size: 17.5px;">tcp/ip</a> <a href="/tags/web开发/" style="font-size: 16.25px;">web开发</a> <a href="/tags/云计算/" style="font-size: 18.75px;">云计算</a> <a href="/tags/区块链/" style="font-size: 10px;">区块链</a> <a href="/tags/大小端/" style="font-size: 10px;">大小端</a> <a href="/tags/数据库/" style="font-size: 12.5px;">数据库</a> <a href="/tags/系统管理/" style="font-size: 15px;">系统管理</a> <a href="/tags/计算机网络/" style="font-size: 17.5px;">计算机网络</a> <a href="/tags/集群/" style="font-size: 13.75px;">集群</a> <a href="/tags/默认/" style="font-size: 10px;">默认</a>
    </div>
  </aside>

  
    <aside class="widget">
    <h3 class="widget-title">Links</h3>
    <div class="widget-content">
		<ul id="link-list">
		<!-- link begin -->

		<li><a href="https://www.google.com/">google</a></li>
		<li><a href="https://www.baidu.com/">baidu</a></li>
		
		<!-- link end -->
		</ul>
    </div>
</aside>

  
    <aside class="widget">
    <h3 class="widget-title">Ads</h3>
    <div class="widget-content">
	 
			* <a target="_blank" href="https://amazon.cn/gp/search?ie=UTF8&tag=momoda-23&linkCode=ur2&linkId=4a0e4fbec0cfa8dfe540ca999d0bf999&camp=536&creative=3200&index=books&keywords=编程">这些好书您看了吗?</a><img src="//ir-cn.amazon-adsystem.com/e/ir?t=momoda-23&l=ur2&o=28" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;">
			<br><br>
			* 体育&户外用品推荐>
			<div align="center"> <a href="https://www.amazon.cn/B07HWB88Z5/dp/B07HWB88Z5/ref=as_sl_pc_tf_til?tag=momoda-23&linkCode=w00&linkId=14df5124f2165d9eb3d65252e60ed2cf&creativeASIN=B07HWB88Z5"><img src="/more/ads/amazon.gif" width="100%"></a> </div>

    </div>
</aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 momoda
    All rights reserved.</p>
    <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
    <a href="javascript:scrollTo(0,0);">返回顶部</a>
</footer>

    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>


<script type="text/javascript" src="https://js.users.51.la/19862371.js"></script>
<div id="bg"></div>

  </div>
</body>
</html>